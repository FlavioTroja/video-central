var Playlist={video_central_modal:{__instance:void 0}};Playlist.video_central_modal.Application=Backbone.View.extend({id:"backbone_modal_dialog",options:{},events:{"click .media-modal-close":"closeModal","click #btn-cancel":"closeModal","click #btn-ok":"saveModal","click .navigation-bar a":"doNothing"},loopArgs:{posts_per_page:40,page:1,view:"latest"},selectedVideos:[],ui:{nav:void 0,content:void 0},templates:{},initialize:function(){"use strict";_.bindAll(this,"render","preserveFocus","closeModal","saveModal","doNothing"),this.videoPlaylistAddToolbar(),this.initialize_templates(),this.render()},initialize_templates:function(){this.templates.window=window.wp.template("video-central-playlist-modal-window"),this.templates.backdrop=window.wp.template("video-central-playlist-modal-backdrop"),this.templates.menuItem=window.wp.template("video-central-playlist-modal-menu-item"),this.templates.menuItemSeperator=window.wp.template("video-central-playlist-modal-menu-item-separator")},getfilters:function(){},render:function(){"use strict";this.$el.attr("tabindex","0").append(this.templates.window()).append(this.templates.backdrop()),this.getfilters();var a=jQuery("body").find("#_video_central_playlist_ids").val();this.selectedVideos=a.split(","),this.ui.nav=this.$(".navigation-bar nav ul"),this.ui.content=this.$(".media-frame-content .attachments-browser"),this.getVideos(),jQuery(document).on("focusin",this.preserveFocus),jQuery("body").css({overflow:"hidden"}).append(this.$el),this.$el.focus()},eventsHandler:function(){this.options.scrollElement=jQuery(".attachments-browser .attachments"),this.scroll=_.chain(this.scroll).bind(this).throttle(200).value(),jQuery(this.options.scrollElement).on("scroll",this.scroll),this.preSelected(),this.itemSelection(),this.removeitemSelection()},attachmentFocus:function(){this.jQuery("li:first").focus()},restoreFocus:function(){this.jQuery("li.selected:first").focus()},scroll:function(){var a,b,c=this.options.scrollElement;a=jQuery(".attachments-browser .attachments"),c=a[0],b=c.scrollTop,a.scrollTop()+a.innerHeight()>=c.scrollHeight&&this.paginateVideos()},getVideos:function(){var a,b=this;this.toolbar;return this.playlistAjax=jQuery.ajax({type:"GET",url:window.ajaxurl,cache:!0,data:{action:"video_central_get_playlist_video_list",page:b.loopArgs.page,posts_per_page:b.loopArgs.posts_per_page,filter:"",filter_id:"",view:b.loopArgs.view},success:function(c,d,e){a=jQuery.parseJSON(c),b.ui.content.find("ul.attachments").append(a),b.eventsHandler(),console.log(b.loopArgs.page)},error:function(a,b,c){console.log(b)}}),a},paginateVideos:function(){this.loopArgs.page++,this.getVideos()},preSelected:function(){var a=this;this.ui.content.find("li").each(function(b){var c=jQuery(this).data("id");console.log(c),console.log(jQuery.inArray(c,a.selectedVideos)),jQuery.inArray(c,a.selectedVideos)&&jQuery(this).trigger("click")})},itemSelection:function(){var a=this;this.ui.content.find("li").on("click",function(b){jQuery(this).addClass("selected details");var c=jQuery(this).data("id");c&&a.selectedVideos.push(c)})},removeitemSelection:function(){var a=this.selectedVideos;this.ui.content.find(".button-link").on("click",function(b){var c=jQuery(this).parent();if(c.hasClass("selected")){c.removeClass("selected"),jQuery(this).remove();var d=c.data("id"),e=a.indexOf(d);e>-1&&a.splice(e,1)}})},UniqueIds:function(){this.selectedVideos=jQuery.unique(this.selectedVideos),console.log(this.selectedVideos)},updatePlaylist:function(){this.UniqueIds(),jQuery("body").find("#_video_central_playlist_ids").attr("value",this.selectedVideos.toString())},videoPlaylistAddToolbar:function(){},preserveFocus:function(a){"use strict";this.$el[0]===a.target||this.$el.has(a.target).length||this.$el.focus()},closeModal:function(a){"use strict";a.preventDefault(),this.undelegateEvents(),jQuery(document).off("focusin"),jQuery("body").css({overflow:"auto"}),this.remove(),this.playlistAjax.abort(),this.loopArgs.page=1,Playlist.video_central_modal.__instance=void 0},saveModal:function(a){"use strict";this.updatePlaylist(),this.closeModal(a)},doNothing:function(a){"use strict";a.preventDefault()}}),jQuery(function(a){"use strict";a("#add-videos a").click(function(a){a.preventDefault(),void 0===Playlist.video_central_modal.__instance&&(Playlist.video_central_modal.__instance=new Playlist.video_central_modal.Application)})});